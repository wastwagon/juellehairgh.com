# üåê Domain Setup Guide - juellehairgh.com

This guide will help you connect your custom domain `juellehairgh.com` to your Coolify deployment.

## üìã Prerequisites

- ‚úÖ Your domain `juellehairgh.com` is registered
- ‚úÖ You have access to your domain's DNS settings
- ‚úÖ Backend and frontend services are running in Coolify
- ‚úÖ Preview URLs are working correctly

---

## üîß Step-by-Step Domain Setup

### Step 1: Configure Domain in Coolify

#### For Frontend Service:

1. **Go to Frontend Service** in Coolify
2. **Navigate to "Domains" or "Configuration" ‚Üí "General"**
3. **Add Domain:**
   - Click **"Add Domain"** or **"Generate Domain"**
   - Enter: `juellehairgh.com`
   - Also add: `www.juellehairgh.com` (optional, for www subdomain)
   - Enable **SSL/TLS** (HTTPS)

#### For Backend Service:

1. **Go to Backend Service** in Coolify
2. **Navigate to "Domains" or "Configuration" ‚Üí "General"**
3. **Add Domain:**
   - Click **"Add Domain"** or **"Generate Domain"**
   - Enter: `api.juellehairgh.com`
   - Enable **SSL/TLS** (HTTPS)

---

### Step 2: Update Environment Variables

#### Frontend Environment Variables:

Go to **Frontend Service** ‚Üí **Environment Variables** and update:

```
NEXT_PUBLIC_API_BASE_URL=https://api.juellehairgh.com/api
NEXTAUTH_URL=https://juellehairgh.com
```

**Important:** Make sure ‚úÖ **"Available at Buildtime"** is checked for `NEXT_PUBLIC_API_BASE_URL`

#### Backend Environment Variables:

Go to **Backend Service** ‚Üí **Environment Variables** and update:

```
FRONTEND_URL=https://juellehairgh.com
```

---

### Step 3: Configure DNS Records

Go to your domain registrar's DNS settings and add these records:

#### Option A: Using A Records (Recommended for static IP)

```
Type: A
Name: @ (or leave blank for root domain)
Value: [Your Coolify server IP]
TTL: 3600 (or default)

Type: A
Name: www
Value: [Your Coolify server IP]
TTL: 3600 (or default)

Type: A
Name: api
Value: [Your Coolify server IP]
TTL: 3600 (or default)
```

#### Option B: Using CNAME Records (If using subdomain or CDN)

```
Type: CNAME
Name: @ (or leave blank)
Value: [Your Coolify domain or CDN endpoint]
TTL: 3600

Type: CNAME
Name: www
Value: [Your Coolify domain or CDN endpoint]
TTL: 3600

Type: CNAME
Name: api
Value: [Your Coolify domain or CDN endpoint]
TTL: 3600
```

**Note:** Replace `[Your Coolify server IP]` with your actual server IP address (e.g., `31.97.57.75` based on your preview URLs).

---

### Step 4: Wait for DNS Propagation

DNS changes can take:
- **Minimum:** 5-15 minutes
- **Average:** 1-2 hours
- **Maximum:** 48 hours

**Check DNS propagation:**
```bash
# Check if DNS is resolving
nslookup juellehairgh.com
nslookup api.juellehairgh.com
nslookup www.juellehairgh.com

# Or use online tools:
# - https://dnschecker.org
# - https://whatsmydns.net
```

---

### Step 5: Redeploy Services

**CRITICAL:** After updating environment variables, you **MUST** redeploy both services:

1. **Redeploy Frontend:**
   - Go to Frontend Service
   - Click **"Redeploy"** button
   - Wait for deployment to complete

2. **Redeploy Backend:**
   - Go to Backend Service
   - Click **"Redeploy"** button (optional if only FRONTEND_URL changed)
   - Wait for deployment to complete

**Why?** `NEXT_PUBLIC_*` variables are embedded at build time, so a rebuild is required.

---

### Step 6: Verify SSL Certificates

Coolify should automatically issue SSL certificates via Let's Encrypt. Check:

1. **Frontend Service** ‚Üí **Domains**
   - `juellehairgh.com` should show SSL certificate status
   - Wait for certificate to be issued (usually 1-5 minutes)

2. **Backend Service** ‚Üí **Domains**
   - `api.juellehairgh.com` should show SSL certificate status
   - Wait for certificate to be issued

---

### Step 7: Test Your Domain

#### Test Frontend:
```
https://juellehairgh.com
https://www.juellehairgh.com (if configured)
```

#### Test Backend API:
```
https://api.juellehairgh.com/api/health
```

#### Test in Browser Console:
1. Open **https://juellehairgh.com**
2. Press **F12** ‚Üí **Network** tab
3. Navigate the site
4. Verify API calls go to: `https://api.juellehairgh.com/api/...`
5. Check for no SSL/certificate errors

---

## üìù Complete Environment Variable Checklist

### Frontend Service Environment Variables:

```env
# Domain Configuration
NEXT_PUBLIC_API_BASE_URL=https://api.juellehairgh.com/api
NEXTAUTH_URL=https://juellehairgh.com

# Application Settings
NEXT_PUBLIC_APP_NAME=Juelle Hair Ghana
NEXT_PUBLIC_BASE_CURRENCY=GHS
NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY=pk_live_your_key_here
NEXTAUTH_SECRET=your-secret-here
NODE_ENV=production

# Service URLs (Auto-generated by Coolify, don't change)
SERVICE_FQDN_FRONTEND=juellehairgh.com
SERVICE_URL_FRONTEND=https://juellehairgh.com
```

### Backend Service Environment Variables:

```env
# Domain Configuration
FRONTEND_URL=https://juellehairgh.com

# Database Configuration
POSTGRES_HOST=your-database-service-name
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-secure-password
POSTGRES_DB=juellehair
DATABASE_URL=postgresql://postgres:password@host:5432/juellehair?schema=public

# Application Settings
JWT_SECRET=your-jwt-secret
PAYSTACK_SECRET_KEY=sk_live_your_key_here
PORT=3001
NODE_ENV=production
```

---

## üîç Troubleshooting

### Domain Not Resolving

**Check DNS records:**
```bash
dig juellehairgh.com
dig api.juellehairgh.com
```

**Wait longer:** DNS can take up to 48 hours to propagate globally.

**Verify IP address:** Make sure your A records point to the correct Coolify server IP.

### SSL Certificate Not Issuing

**Common causes:**
1. DNS not fully propagated
2. Domain not pointing to Coolify server
3. Port 80/443 not accessible

**Solutions:**
- Wait 15-30 minutes and try again
- Verify DNS is resolving correctly
- Check firewall/security group settings
- Try manually triggering certificate renewal in Coolify

### Frontend Still Using Preview URL

**Issue:** Frontend API calls still go to preview URL instead of `api.juellehairgh.com`

**Solutions:**
1. Verify `NEXT_PUBLIC_API_BASE_URL` is set correctly
2. Make sure "Available at Buildtime" is checked
3. **Redeploy frontend** (critical!)
4. Clear browser cache
5. Check browser console for errors

### Backend Not Accessible

**Test backend directly:**
```bash
curl https://api.juellehairgh.com/api/health
```

**Check:**
- Backend service is running in Coolify
- Domain is configured correctly
- SSL certificate is issued
- Backend logs for errors

### Mixed Content Warnings

**Issue:** Browser shows "Mixed Content" warnings

**Solution:** Ensure all URLs use `https://` (not `http://`) in environment variables.

---

## üéØ Quick Checklist

- [ ] Domain added to Frontend service in Coolify
- [ ] Domain added to Backend service in Coolify
- [ ] DNS A records configured (juellehairgh.com, www, api)
- [ ] DNS propagation checked (wait 1-2 hours if needed)
- [ ] Frontend environment variables updated
- [ ] Backend environment variables updated
- [ ] Frontend service redeployed
- [ ] Backend service redeployed (if needed)
- [ ] SSL certificates issued
- [ ] https://juellehairgh.com loads correctly
- [ ] https://api.juellehairgh.com/api/health works
- [ ] API calls use correct domain (check browser console)

---

## üìö Additional Resources

- **Coolify Documentation:** https://coolify.io/docs
- **DNS Propagation Checker:** https://dnschecker.org
- **SSL Certificate Checker:** https://www.ssllabs.com/ssltest/

---

## üîÑ Rollback Plan

If something goes wrong, you can quickly rollback:

1. **Revert environment variables** to preview URLs:
   ```
   NEXT_PUBLIC_API_BASE_URL=https://fkco8g8sso4soo00g0skg4w8.31.97.57.75.sslip.io/api
   NEXTAUTH_URL=https://sgcgkockwkg8kgsowww44w4o.31.97.57.75.sslip.io
   FRONTEND_URL=https://sgcgkockwkg8kgsowww44w4o.31.97.57.75.sslip.io
   ```

2. **Redeploy services**

3. **Your preview URLs will still work** while you fix domain issues

---

## ‚úÖ Success Indicators

You'll know everything is working when:

1. ‚úÖ `https://juellehairgh.com` loads without errors
2. ‚úÖ `https://api.juellehairgh.com/api/health` returns 200 OK
3. ‚úÖ Browser console shows API calls to `api.juellehairgh.com`
4. ‚úÖ No SSL certificate warnings
5. ‚úÖ Site functionality works (login, checkout, etc.)
6. ‚úÖ Shipping regions dropdown works correctly
7. ‚úÖ All forms submit successfully

Good luck! üöÄ
