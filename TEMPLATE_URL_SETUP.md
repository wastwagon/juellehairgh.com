# üåê Template/Preview URL Setup Guide

## Overview

Use Coolify's auto-generated template/preview URLs to test your website **before** connecting your actual domain. This lets you verify everything works correctly.

## Step 1: Use Coolify's Auto-Generated URLs

Coolify automatically generates preview URLs for your services. You'll find them in:

### For Backend Service:
1. Go to **Backend service** in Coolify
2. Click **"Links"** tab
3. You'll see a URL like: `https://h0wogckw88c8w8g40w0g4w8g-backend-xxxxx.your-server.com`
   - Or: `http://your-server-ip:3001`

### For Frontend Service:
1. Go to **Frontend service** in Coolify  
2. Click **"Links"** tab
3. You'll see a URL like: `https://xxxxx-frontend-xxxxx.your-server.com`
   - Or: `http://your-server-ip:3000`

**Note:** These URLs are automatically generated by Coolify and use HTTPS with SSL certificates.

## Step 2: Update Environment Variables for Template URLs

### Backend Service Environment Variables

Use the **preview URLs** instead of your real domain:

```
POSTGRES_HOST=wg4kgo8g08c4gcsk080ssoww
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=JuelleHair2026
POSTGRES_DB=juellehair
JWT_SECRET=PCwghTqQLAVLZzw2UdQlrnKc1d1uQhC15nRxq04dT5s=
FRONTEND_URL=<frontend-preview-url-from-coolify>
PORT=3001
NODE_ENV=production
```

**Replace `<frontend-preview-url-from-coolify>` with:**
- The preview URL from Frontend service Links tab
- Example: `https://xxxxx-frontend-xxxxx.your-server.com`

### Frontend Service Environment Variables

```
NEXT_PUBLIC_API_BASE_URL=<backend-preview-url>/api
NEXTAUTH_URL=<frontend-preview-url>
NEXTAUTH_SECRET=fn5e7Nhost1t/ONNBVVWGZYDS8nqz+fyEJ2Y5ykUdN0=
NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY=<your-paystack-key>
NEXT_PUBLIC_APP_NAME=Juelle Hair Ghana
NEXT_PUBLIC_BASE_CURRENCY=GHS
NODE_ENV=production
```

**Replace URLs with:**
- `<backend-preview-url>` = Backend preview URL from Links tab
- `<frontend-preview-url>` = Frontend preview URL from Links tab

**Important:** Make sure `NEXT_PUBLIC_API_BASE_URL` includes `/api` at the end!

## Step 3: Find Your Preview URLs

### Option A: From Coolify Links Tab

1. **Backend Service:**
   - Go to Backend ‚Üí **Links** tab
   - Copy the HTTPS URL (will be something like `https://xxxxx-backend-xxxxx.coolify.xxx`)

2. **Frontend Service:**
   - Go to Frontend ‚Üí **Links** tab
   - Copy the HTTPS URL

### Option B: Check Deployment Logs

In your deployment logs, you might see URLs like:
- `Service URL: https://xxxxx-backend-xxxxx.coolify.xxx`
- These are your preview URLs

### Option C: Use Server IP (If no preview URLs)

If Coolify doesn't show preview URLs:
- **Backend:** `http://your-server-ip:3001` or `https://your-server-ip:3001`
- **Frontend:** `http://your-server-ip:3000` or `https://your-server-ip:3000`

Replace `your-server-ip` with your actual server IP address.

## Step 4: Example Configuration

Let's say your preview URLs are:

**Backend:** `https://h0wogckw88c8w8g40w0g4w8g-backend-172145046375.coolify.localhost`  
**Frontend:** `https://h0wogckw88c8w8g40w0g4w8g-frontend-172145046375.coolify.localhost`

### Backend Environment Variables:
```
FRONTEND_URL=https://h0wogckw88c8w8g40w0g4w8g-frontend-172145046375.coolify.localhost
POSTGRES_HOST=wg4kgo8g08c4gcsk080ssoww
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=JuelleHair2026
POSTGRES_DB=juellehair
JWT_SECRET=PCwghTqQLAVLZzw2UdQlrnKc1d1uQhC15nRxq04dT5s=
PORT=3001
NODE_ENV=production
```

### Frontend Environment Variables:
```
NEXT_PUBLIC_API_BASE_URL=https://h0wogckw88c8w8g40w0g4w8g-backend-172145046375.coolify.localhost/api
NEXTAUTH_URL=https://h0wogckw88c8w8g40w0g4w8g-frontend-172145046375.coolify.localhost
NEXTAUTH_SECRET=fn5e7Nhost1t/ONNBVVWGZYDS8nqz+fyEJ2Y5ykUdN0=
NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY=pk_test_your_key_here
NEXT_PUBLIC_APP_NAME=Juelle Hair Ghana
NEXT_PUBLIC_BASE_CURRENCY=GHS
NODE_ENV=production
```

**‚ö†Ô∏è Remember:** For `NEXT_PUBLIC_*` variables, check **"Available at Buildtime"** ‚úÖ

## Step 5: Redeploy Services

After updating environment variables:

1. **Redeploy Backend** service
2. **Redeploy Frontend** service (important - frontend needs to rebuild with new URLs)

## Step 6: Test Everything

1. **Visit Frontend Preview URL:**
   - Should load your website
   - Check browser console for errors

2. **Test API Connection:**
   - Open browser DevTools ‚Üí Network tab
   - Navigate the site
   - Check if API calls are going to your backend preview URL

3. **Test Health Endpoints:**
   - Frontend: `https://your-frontend-preview-url/`
   - Backend: `https://your-backend-preview-url/api/health`
   - Database: `https://your-backend-preview-url/api/health/db`

## Step 7: Switch to Your Real Domain (When Ready)

Once everything works with preview URLs:

### 1. Update DNS Records

Point your domain to your server:
- `@` (root) ‚Üí Your server IP
- `www` ‚Üí Your server IP  
- `api` ‚Üí Your server IP

### 2. Add Domains in Coolify

**Backend Service:**
1. Go to Backend ‚Üí **Configuration** ‚Üí **General**
2. In **Domains** section, add: `api.juellehairgh.com`

**Frontend Service:**
1. Go to Frontend ‚Üí **Configuration** ‚Üí **General**
2. In **Domains** section, add: `juellehairgh.com` and `www.juellehairgh.com`

### 3. Update Environment Variables

**Backend:**
```
FRONTEND_URL=https://juellehairgh.com
```

**Frontend:**
```
NEXT_PUBLIC_API_BASE_URL=https://api.juellehairgh.com/api
NEXTAUTH_URL=https://juellehairgh.com
```

### 4. Redeploy Both Services

Redeploy after domain changes so SSL certificates are generated.

## Quick Checklist

### Using Preview/Template URLs:
- ‚úÖ Get preview URLs from Coolify Links tab
- ‚úÖ Update `FRONTEND_URL` in Backend with frontend preview URL
- ‚úÖ Update `NEXT_PUBLIC_API_BASE_URL` in Frontend with backend preview URL + `/api`
- ‚úÖ Update `NEXTAUTH_URL` in Frontend with frontend preview URL
- ‚úÖ Check "Available at Buildtime" for all `NEXT_PUBLIC_*` variables
- ‚úÖ Redeploy both services
- ‚úÖ Test both frontend and backend URLs

### Switching to Real Domain:
- ‚úÖ Add DNS A records pointing to server IP
- ‚úÖ Add domains in Coolify Configuration ‚Üí General ‚Üí Domains
- ‚úÖ Update environment variables with real domains
- ‚úÖ Redeploy services
- ‚úÖ Wait for SSL certificates (automatic in Coolify)

## Troubleshooting

### Preview URL not working?

1. **Check Links tab** - Make sure the URL is correct
2. **Check HTTPS** - Use HTTPS if Coolify provides it
3. **Check firewall** - Ensure ports are accessible
4. **Check service status** - Make sure services are running

### Frontend can't connect to backend?

1. **Verify `NEXT_PUBLIC_API_BASE_URL`** includes `/api` at the end
2. **Check backend is accessible** - Visit backend preview URL directly
3. **Check CORS** - Backend `FRONTEND_URL` should match frontend preview URL

### After switching to real domain:

1. **DNS Propagation** - Wait 5-30 minutes for DNS to propagate
2. **SSL Certificates** - Coolify auto-generates, wait 1-2 minutes
3. **Clear Browser Cache** - Old preview URLs might be cached

## Benefits of Testing First

‚úÖ **Verify functionality** before pointing real domain  
‚úÖ **Test SSL certificates** with preview URLs  
‚úÖ **Check all features** work correctly  
‚úÖ **No downtime** when switching domains  
‚úÖ **Easy rollback** if issues occur  

## Next Steps

1. Get your preview URLs from Coolify Links tabs
2. Update environment variables with preview URLs
3. Redeploy services
4. Test everything thoroughly
5. Switch to your real domain when ready!
