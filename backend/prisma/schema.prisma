generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String         @id @default(uuid())
  email                String         @unique
  password             String
  name                 String?
  phone                String?
  displayCurrency      String?        @default("GHS")
  role                 UserRole       @default(CUSTOMER)
  emailVerified        Boolean        @default(false)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  profilePicture       String?
  emailMarketing       Boolean        @default(true)
  emailOrderUpdates    Boolean        @default(true)
  emailReviewReminders Boolean        @default(true)
  emailNewsletter      Boolean        @default(false)
  deletedAt            DateTime?
  deletionReason       String?
  deletionRequestedAt  DateTime?
  passwordResetToken   String?        @unique
  passwordResetExpires DateTime?
  addresses            Address[]
  cart                 Cart?
  orders               Order[]
  reviews              Review[]
  wallet               Wallet?
  wishlist             WishlistItem[]

  @@index([passwordResetToken])
  @@map("users")
}

model Address {
  id             String   @id @default(uuid())
  userId         String
  firstName      String
  lastName       String
  phone          String
  addressLine1   String
  addressLine2   String?
  city           String
  region         String
  postalCode     String?
  country        String   @default("Ghana")
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders  Order[]  @relation("BillingAddress")
  shippingOrders Order[]  @relation("ShippingAddress")

  @@map("addresses")
}

model Category {
  id          String       @id @default(uuid())
  name        String
  slug        String       @unique
  description String?
  image       String?
  parentId    String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  parent      Category?    @relation("CategoryTree", fields: [parentId], references: [id])
  children    Category[]   @relation("CategoryTree")
  seo         CategorySEO?
  products    Product[]

  @@index([parentId])
  @@map("categories")
}

model Brand {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  logo      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]

  @@map("brands")
}

model Product {
  id                 String              @id @default(uuid())
  title              String
  slug               String              @unique
  description        String?
  brandId            String?
  categoryId         String
  priceGhs           Decimal             @db.Decimal(10, 2)
  compareAtPriceGhs  Decimal?            @db.Decimal(10, 2)
  images             String[]
  badges             String[]
  stock              Int                 @default(0)
  sku                String?             @unique
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  shortDescription   String?
  cartItems          CartItem[]
  collectionProducts CollectionProduct[]
  flashSales         FlashSaleProduct[]
  orderItems         OrderItem[]
  seo                ProductSEO?
  variants           ProductVariant[]
  brand              Brand?              @relation(fields: [brandId], references: [id])
  category           Category            @relation(fields: [categoryId], references: [id])
  reviews            Review[]
  wishlistItems      WishlistItem[]

  @@index([categoryId])
  @@index([brandId])
  @@index([slug])
  @@index([isActive])
  @@map("products")
}

model ProductAttribute {
  id          String                 @id @default(uuid())
  name        String                 @unique
  slug        String                 @unique
  description String?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  terms       ProductAttributeTerm[]

  @@map("product_attributes")
}

model ProductAttributeTerm {
  id          String           @id @default(uuid())
  name        String
  slug        String
  image       String?
  attributeId String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  attribute   ProductAttribute @relation(fields: [attributeId], references: [id], onDelete: Cascade)

  @@unique([attributeId, slug])
  @@index([attributeId])
  @@map("product_attribute_terms")
}

model ProductVariant {
  id                String      @id @default(uuid())
  productId         String
  name              String
  value             String
  priceGhs          Decimal?    @db.Decimal(10, 2)
  stock             Int         @default(0)
  sku               String?     @unique
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  image             String?
  compareAtPriceGhs Decimal?    @db.Decimal(10, 2)
  cartItems         CartItem[]
  orderItems        OrderItem[]
  product           Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_variants")
}

model Collection {
  id          String              @id @default(uuid())
  name        String
  slug        String              @unique
  description String?
  image       String?
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  products    CollectionProduct[]

  @@index([slug])
  @@index([isActive])
  @@map("collections")
}

model CollectionProduct {
  id           String     @id @default(uuid())
  collectionId String
  productId    String
  position     Int        @default(0)
  createdAt    DateTime   @default(now())
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([collectionId, productId])
  @@index([collectionId])
  @@index([productId])
  @@map("collection_products")
}

model Cart {
  id        String     @id @default(uuid())
  userId    String?    @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     CartItem[]
  user      User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model CartItem {
  id         String          @id @default(uuid())
  cartId     String
  productId  String
  variantId  String?
  quantity   Int
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  variantIds String[]        @default([])
  cart       Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product    Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant    ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@map("cart_items")
}

model Order {
  id                String        @id @default(uuid())
  userId            String
  status            OrderStatus   @default(AWAITING_PAYMENT)
  totalGhs          Decimal       @db.Decimal(10, 2)
  displayCurrency   String?       @default("GHS")
  displayTotal      Decimal?      @db.Decimal(10, 2)
  shippingAddressId String
  billingAddressId  String
  paymentReference  String?       @unique
  paymentStatus     PaymentStatus @default(PENDING)
  paymentMethod     String?       @default("paystack")
  shippingMethod    String?
  trackingNumber    String?
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  items             OrderItem[]
  billingAddress    Address       @relation("BillingAddress", fields: [billingAddressId], references: [id])
  shippingAddress   Address       @relation("ShippingAddress", fields: [shippingAddressId], references: [id])
  user              User          @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([paymentReference])
  @@index([createdAt])
  @@map("orders")
}

model OrderItem {
  id         String          @id @default(uuid())
  orderId    String
  productId  String
  variantId  String?
  quantity   Int
  priceGhs   Decimal         @db.Decimal(10, 2)
  createdAt  DateTime        @default(now())
  variantIds String[]        @default([])
  order      Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product         @relation(fields: [productId], references: [id])
  variant    ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model WishlistItem {
  id        String   @id @default(uuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@map("wishlist_items")
}

model Review {
  id         String   @id @default(uuid())
  userId     String
  productId  String
  rating     Int
  title      String?
  comment    String?
  isVerified Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([productId, userId])
  @@map("reviews")
}

model ShippingZone {
  id          String           @id @default(uuid())
  name        String
  description String?
  regions     String[]
  isActive    Boolean          @default(true)
  position    Int              @default(0)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  methods     ShippingMethod[]

  @@index([isActive])
  @@map("shipping_zones")
}

model ShippingMethod {
  id                    String       @id @default(uuid())
  zoneId                String
  name                  String
  description           String?
  cost                  Decimal?     @db.Decimal(10, 2)
  freeShippingThreshold Decimal?     @db.Decimal(10, 2)
  estimatedDays         String?
  isActive              Boolean      @default(true)
  position              Int          @default(0)
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  zone                  ShippingZone @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([zoneId])
  @@index([isActive])
  @@map("shipping_methods")
}

model CurrencyRate {
  id             String   @id @default(uuid())
  baseCurrency   String   @default("GHS")
  targetCurrency String
  rate           Decimal  @db.Decimal(18, 8)
  updatedAt      DateTime @default(now()) @updatedAt

  @@unique([baseCurrency, targetCurrency])
  @@index([baseCurrency, targetCurrency])
  @@map("currency_rates")
}

model Banner {
  id        String    @id @default(uuid())
  title     String
  subtitle  String?
  image     String
  link      String?
  isActive  Boolean   @default(true)
  position  Int       @default(0)
  startDate DateTime?
  endDate   DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([isActive, position])
  @@map("banners")
}

model DiscountCode {
  id            String    @id @default(uuid())
  code          String    @unique
  description   String?
  discountType  String
  discountValue Decimal   @db.Decimal(10, 2)
  minPurchase   Decimal?  @db.Decimal(10, 2)
  maxDiscount   Decimal?  @db.Decimal(10, 2)
  usageLimit    Int?
  usedCount     Int       @default(0)
  isActive      Boolean   @default(true)
  startDate     DateTime?
  endDate       DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([code])
  @@index([isActive])
  @@map("discount_codes")
}

model AnalyticsEvent {
  id        String   @id @default(uuid())
  eventType String
  userId    String?
  sessionId String?
  productId String?
  orderId   String?
  revenue   Decimal? @db.Decimal(10, 2)
  metadata  Json     @default("{}")
  createdAt DateTime @default(now())

  @@index([eventType])
  @@index([userId])
  @@index([sessionId])
  @@index([productId])
  @@index([orderId])
  @@index([createdAt])
  @@map("analytics_events")
}

model ProductSEO {
  id              String   @id @default(uuid())
  productId       String   @unique
  metaTitle       String?
  metaDescription String?
  focusKeyword    String?
  keywords        String[]
  schemaType      String   @default("Product")
  schemaData      Json     @default("{}")
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  twitterCard     String?  @default("summary_large_image")
  canonicalUrl    String?
  noindex         Boolean  @default(false)
  nofollow        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_seo")
}

model CategorySEO {
  id              String   @id @default(uuid())
  categoryId      String   @unique
  metaTitle       String?
  metaDescription String?
  keywords        String[]
  schemaData      Json?    @default("{}")
  ogTitle         String?
  ogDescription   String?
  ogImage         String?
  canonicalUrl    String?
  noindex         Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  category        Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@map("category_seo")
}

model SEOTemplate {
  id            String   @id @default(uuid())
  name          String
  type          String
  titleTemplate String
  metaTemplate  String
  variables     Json     @default("{}")
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([type, isDefault])
  @@index([type])
  @@map("seo_templates")
}

model Redirect {
  id        String    @id @default(uuid())
  sourceUrl String    @unique
  targetUrl String
  type      String    @default("301")
  regex     Boolean   @default(false)
  active    Boolean   @default(true)
  hitCount  Int       @default(0)
  lastHit   DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([sourceUrl])
  @@index([active])
  @@map("redirects")
}

model Error404 {
  id         String   @id @default(uuid())
  url        String
  referer    String?
  userAgent  String?
  hitCount   Int      @default(1)
  firstSeen  DateTime @default(now())
  lastSeen   DateTime @default(now())
  resolved   Boolean  @default(false)
  redirectId String?

  @@index([url])
  @@index([resolved])
  @@index([firstSeen])
  @@map("error_404s")
}

model Keyword {
  id           String   @id @default(uuid())
  keyword      String   @unique
  searchVolume Int?
  difficulty   Int?
  cpc          Decimal? @db.Decimal(10, 2)
  trends       Json?
  suggestions  String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  competition  Decimal? @db.Decimal(3, 2)

  @@index([keyword])
  @@map("keywords")
}

model KeywordRank {
  id        String   @id @default(uuid())
  keyword   String
  productId String?
  pageUrl   String
  position  Int?
  country   String   @default("gh")
  device    String   @default("desktop")
  date      DateTime @default(now())
  createdAt DateTime @default(now())

  @@index([keyword, date])
  @@index([productId])
  @@map("keyword_ranks")
}

model ContentAnalysis {
  id                String   @id @default(uuid())
  productId         String?  @unique
  pageId            String?
  seoScore          Int
  readabilityScore  Int?
  keywordDensity    Json?
  contentLength     Int?
  wordCount         Int?
  headingStructure  Json?
  imageOptimization Json?
  internalLinks     Int?
  externalLinks     Int?
  recommendations   Json?
  lastAnalyzed      DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([productId])
  @@map("content_analysis")
}

model Backlink {
  id              String   @id @default(uuid())
  sourceUrl       String
  targetUrl       String
  anchorText      String?
  domain          String
  domainAuthority Int?
  spamScore       Int?
  firstSeen       DateTime @default(now())
  lastSeen        DateTime @default(now())
  status          String   @default("active")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([targetUrl])
  @@index([domain])
  @@index([status])
  @@map("backlinks")
}

model InternalLink {
  id         String   @id @default(uuid())
  sourceId   String
  sourceType String
  targetId   String
  targetType String
  anchorText String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([sourceId])
  @@index([targetId])
  @@map("internal_links")
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String?
  category  String   @default("general")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@index([category])
  @@map("settings")
}

model Newsletter {
  id             String    @id @default(uuid())
  email          String    @unique
  name           String?
  isActive       Boolean   @default(true)
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
  source         String?
  token          String    @unique
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([email])
  @@index([isActive])
  @@index([subscribedAt])
  @@map("newsletter")
}

model BadgeTemplate {
  id           String   @id @default(uuid())
  name         String   @unique
  label        String
  color        String   @default("#3B82F6")
  textColor    String   @default("#FFFFFF")
  style        String   @default("rounded")
  isPredefined Boolean  @default(false)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([name])
  @@index([isActive])
  @@map("badge_templates")
}

model EmailTemplate {
  id          String   @id @default(uuid())
  templateId  String   @unique
  name        String
  subject     String
  body        String
  type        String
  description String?
  variables   Json     @default("[]")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([templateId])
  @@index([type])
  @@index([isActive])
  @@map("email_templates")
}

model TrustBadge {
  id          String   @id @default(uuid())
  title       String
  description String?
  icon        String?
  image       String?
  link        String?
  isActive    Boolean  @default(true)
  position    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([position])
  @@map("trust_badges")
}

model FlashSale {
  id              String             @id @default(uuid())
  title           String
  description     String?
  startDate       DateTime
  endDate         DateTime
  discountPercent Decimal            @db.Decimal(5, 2)
  isActive        Boolean            @default(true)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  products        FlashSaleProduct[]

  @@index([isActive])
  @@index([startDate])
  @@index([endDate])
  @@map("flash_sales")
}

model FlashSaleProduct {
  id          String    @id @default(uuid())
  flashSaleId String
  productId   String
  createdAt   DateTime  @default(now())
  flashSale   FlashSale @relation(fields: [flashSaleId], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([flashSaleId, productId])
  @@index([flashSaleId])
  @@index([productId])
  @@map("flash_sale_products")
}

model BlogPost {
  id             String    @id @default(uuid())
  title          String
  slug           String    @unique
  excerpt        String?
  content        String
  featuredImage  String?
  authorId       String?
  authorName     String?
  category       String?
  tags           String[]
  isPublished    Boolean   @default(false)
  publishedAt    DateTime?
  views          Int       @default(0)
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([slug])
  @@index([isPublished])
  @@index([publishedAt])
  @@index([category])
  @@map("blog_posts")
}

model Wallet {
  id           String              @id @default(uuid())
  userId       String              @unique
  balance      Decimal             @default(0) @db.Decimal(10, 2)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  transactions WalletTransaction[]
  user         User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("wallets")
}

model WalletTransaction {
  id           String                @id @default(uuid())
  walletId     String
  type         WalletTransactionType
  amount       Decimal               @db.Decimal(10, 2)
  description  String?
  reference    String?               @unique
  orderId      String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  balanceAfter Decimal?              @db.Decimal(10, 2)
  wallet       Wallet                @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@index([type])
  @@index([createdAt])
  @@index([reference])
  @@map("wallet_transactions")
}

enum OrderStatus {
  AWAITING_PAYMENT
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum UserRole {
  CUSTOMER
  STAFF
  MANAGER
  ADMIN
}

enum WalletTransactionType {
  TOP_UP
  PAYMENT
  REFUND
  ADMIN_CREDIT
  ADMIN_DEBIT
}
